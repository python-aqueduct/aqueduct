<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Functors &mdash; Aqueduct  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js?v=b3ba4146"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="API documentation" href="api/api.html" />
    <link rel="prev" title="Environment" href="environment.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Aqueduct
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Usage overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="artifact.html">Saving computation results with artifacts</a></li>
<li class="toctree-l1"><a class="reference internal" href="backend.html">Computing backends</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html">Aqueduct CLI</a></li>
<li class="toctree-l1"><a class="reference internal" href="task_advanced.html">Advanced Task Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="environment.html">Environment</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Functors</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#cli-usage">CLI Usage</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api/api.html">API documentation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Aqueduct</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Functors</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/functor.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="functors">
<h1>Functors<a class="headerlink" href="#functors" title="Permalink to this heading"></a></h1>
<p>Functors are transformations applied to tasks. They are used to modify the output of a task
before it is passed to the next task in the pipeline. Functors are useful to apply a configurable
transformation to the output of a task.</p>
<p>The example below illustrates the main features of a Functor:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">MyTask</span><span class="p">(</span><span class="n">Task</span><span class="p">[</span><span class="nb">int</span><span class="p">]):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param</span> <span class="o">=</span> <span class="n">param</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span>

<span class="k">class</span><span class="w"> </span><span class="nc">MyFunctor</span><span class="p">(</span><span class="n">Functor</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">to_add</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">to_add</span> <span class="o">=</span> <span class="n">to_add</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">mapping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_output</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">requirements</span><span class="p">:</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">task_output</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">artifact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="n">MyTask</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;MyFunctor_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">to_add</span><span class="si">}</span><span class="s1">---&#39;</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;MyTask_</span><span class="si">{</span><span class="n">t</span><span class="o">.</span><span class="n">param</span><span class="si">}</span><span class="s1">.pkl&#39;</span>


<span class="n">mapped_task</span> <span class="o">=</span> <span class="n">MyFunctor</span><span class="p">()(</span><span class="n">MyTask</span><span class="p">())</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">aq</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">mapped_task</span><span class="p">)</span>
</pre></div>
</div>
<p>Functors are mostly a software engineering construct (they are useful to organize your code).
A typical usage pattern is computing error metrics.
One <code class="xref py py-class docutils literal notranslate"><span class="pre">Task</span></code> computes the predictions, and a <code class="xref py py-class docutils literal notranslate"><span class="pre">Functor</span></code> computes the error metrics
based on these predictions.
Functors make it easier to implement the case where multiple tasks can produce predictions, but
we want to use the same code to compute the metric:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">ModelA</span><span class="p">(</span><span class="n">aq</span><span class="o">.</span><span class="n">Task</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">3</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ModelB</span><span class="p">(</span><span class="n">aq</span><span class="o">.</span><span class="n">Task</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">2</span>

<span class="k">class</span><span class="w"> </span><span class="nc">GroundTruth</span><span class="p">(</span><span class="n">aq</span><span class="o">.</span><span class="n">Task</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">4</span>

<span class="k">class</span><span class="w"> </span><span class="nc">SquaredError</span><span class="p">(</span><span class="n">aq</span><span class="o">.</span><span class="n">Functor</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">requirements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">GroundTruth</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">mapping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_output</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">requirements</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">task_output</span> <span class="o">-</span> <span class="n">requirements</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>

<span class="n">loss_computation</span> <span class="o">=</span> <span class="n">SquaredError</span><span class="p">()</span>
<span class="n">loss_model_a</span> <span class="o">=</span> <span class="n">loss_computation</span><span class="p">(</span><span class="n">ModelA</span><span class="p">())</span>
<span class="n">loss_model_b</span> <span class="o">=</span> <span class="n">loss_computation</span><span class="p">(</span><span class="n">ModelB</span><span class="p">())</span>
</pre></div>
</div>
<section id="cli-usage">
<h2>CLI Usage<a class="headerlink" href="#cli-usage" title="Permalink to this heading"></a></h2>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="environment.html" class="btn btn-neutral float-left" title="Environment" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="api/api.html" class="btn btn-neutral float-right" title="API documentation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, David Landry.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>